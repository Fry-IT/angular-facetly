!function(){"use strict";angular.module("ngFacetly",["angular-lodash"])}(),function(){"use strict";function e(e){return{restrict:"E",replace:!0,templateUrl:"angular-facetly.html",scope:{options:"=?",filteredBy:"=ngModel",facets:"=",doSearch:"&?"},link:function(t){var n=function(e,t){return _.chain(e).filter(function(e){return _.findIndex(t,{id:e.id})===-1}).map(function(e){return e.label}).value()};t.options=_.assign({},t.options),t.filters=e.setFilters(t.filteredBy,t.facets),t.typeaheadSuggestions=n(t.facets,t.filters),t.addFilter=function(n){t.filters=e.addFilter(t.filters,n)},t.removeFilter=function(n){t.filters=e.removeFilter(t.filters,n)},t.removeAllFilters=function(){t.filters=e.removeAllFilters(),"function"==typeof t.doSearch&&(t.filteredBy=e.updateModel(t.filters),t.doSearch())},t.availableFacets=function(e){var n=t.filters||[];return _.findIndex(n,{id:e.id})===-1},t.search=function(){if(0===t.filters.length&&t.options.defaultFacet.length&&t.query.length){var l=e.findFilterByKey(t.facets,"id",t.options.defaultFacet);l!==-1&&(t.filters=[_.assign({},t.facets[l],{value:t.query})])}t.query="","function"==typeof t.doSearch&&(t.filteredBy=e.updateModel(t.filters),t.doSearch(),t.typeaheadSuggestions=n(t.facets,t.filters))},t.addTypeaheadSuggestion=function(l){var i=e.findFilterByKey(t.facets,"label",l);i!==-1&&(t.filters=e.addFilter(t.filters,t.facets[i]),t.focusIndex=t.filters.indexOf(t.facets[i]),t.query="",t.typeaheadSuggestions=n(t.facets,t.filters))},t.$watch("filteredBy",function(n,l){n!==l&&(t.filters=e.setFilters(t.filteredBy,t.facets))})}}}e.$inject=["FacetlyUtils"],angular.module("ngFacetly").directive("facetly",e)}(),function(){"use strict";function e(e){var t={};return t.setFilters=function(e,t){var n=[];return _.isObject(e)&&(n=_.chain(t).filter(function(t){return _.keys(e).indexOf(t.id)!==-1}).map(function(t){return _.assign({},t,{value:e[t.id]})}).value()),n},t.findFilterByKey=function(e,t,n){return _.findIndex(e,function(e){return e[t]===n})},t.addFilter=function(e,t){var n=this.findFilterByKey(e,"id",t.id);return n===-1?e.concat([t]):e},t.removeFilter=function(e,t){var n=this.findFilterByKey(e,"id",t);return n!==-1?e.slice(0,n).concat(e.slice(n+1)):e},t.removeAllFilters=function(){return[]},t.updateModel=function(e){for(var t={},n=0;n<e.length;n++)_.isUndefined(e[n].value)||(t[e[n].id]=e[n].value);return t},t.flatten=function(e,n){return n=[]||n,_.forEach(e,function(e){n.push({id:e.id,title:e.title}),e.categories&&e.categories.length&&(n=n.concat(t.flatten(e.categories,n)))}),n},t.getFacetIds=function(e,t){return _.isArray(e)?e.map(function(e){return _.find(t,{title:e}).id}):_.find(t,{title:e}).id},t.validateValues=function(e){},t}e.$inject=["$log"],angular.module("ngFacetly").service("FacetlyUtils",e)}(),function(){"use strict";function e(e){return{restrict:"E",replace:!0,templateUrl:"facets/hierarchy.html",scope:{options:"=",allowMultiselect:"=?",onSelectChange:"&"},link:function(t){var n=e.flatten(t.options);t.allowMultiselect=!_.isUndefined(t.allowMultiselect)&&t.allowMultiselect,t.typeaheadSuggestions=_.map(n,function(e){return e.title}),t.addTypeaheadSuggestion=function(l){t.query=_.isArray(l)?"":l,t.onSelectChange({value:e.getFacetIds(l,n)})}}}}e.$inject=["FacetlyUtils"],angular.module("ngFacetly").directive("facetlyHierarchy",e)}(),function(){"use strict";function e(e){return{restrict:"E",replace:!0,templateUrl:"facets/select.html",scope:{options:"=",allowMultiselect:"=?",onSelectChange:"&"},link:function(t){t.allowMultiselect=!_.isUndefined(t.allowMultiselect)&&t.allowMultiselect,t.typeaheadSuggestions=_.map(t.options,function(e){return e.title}),t.addTypeaheadSuggestion=function(n){t.query=_.isArray(n)?"":n,t.onSelectChange({value:e.getFacetIds(n,t.options)})}}}}e.$inject=["FacetlyUtils"],angular.module("ngFacetly").directive("facetlySelect",e)}(),function(){"use strict";function e(){return{restrict:"E",replace:!0,templateUrl:"filter/filter.html",scope:{filter:"=",onFilterRemove:"&",onDoSearch:"&"},link:function(e,t,n){var l;switch(e.filter.type){case"select":l="input";break;default:l="input"}t.on("keydown",function(t){0!==e.filter.value&&13===t.which&&(t.preventDefault(),e.onDoSearch(),e.$apply())}),e.$watch(n.shouldFocus,function(i,a){i===!0&&(t.find(l)[0].focus(),e[n.shouldFocus]=!1)}),e.updateFilterValue=function(t){e.filter.value=t},e.remove=function(){e.onFilterRemove({id:e.filter.id})},e.$on("$destroy",function(){t.off("keydown")})}}}angular.module("ngFacetly").directive("facetlyFilter",e)}(),function(){"use strict";function e(e,t,n){function l(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}function i(e){return/<.*>/g.test(e)}var a;a=t.has("$sanitize");var s=function(t,s){return!a&&i(t)&&n.warn("Unsafe use of typeahead please use ngSanitize"),t=s?(""+t).replace(new RegExp(l(s),"gi"),"<strong>$&</strong>"):t,a||(t=e.trustAsHtml(t)),t};return s}e.$inject=["$sce","$injector","$log"],angular.module("ngFacetly").filter("facetlyHighlight",e)}(),function(){"use strict";function e(e,t){return{restrict:"E",replace:!0,templateUrl:"typeahead/typeahead.html",scope:{query:"=",facets:"=",placeholder:"@?",allowMultiselect:"=?",hideNotFound:"=?",onSelect:"&"},link:function(n,l){var i=[13,38,40,32,27,9],a=function(e){n.onSelect({value:e}),n.allowMultiselect||(n.showSuggestions=!1)},s=function(e){var t=n.selected.indexOf(e);t===-1?n.selected=n.selected.concat([e]):n.selected.splice(t,1)},c=function(e,t){return _.chain(t).filter(function(t){return 0===e.length||t.toLowerCase().indexOf(e.toLowerCase())!==-1}).value()},o=function(t){var n=l.find("ul").children("li")[t];e(function(){l.find("ul")[0].scrollTop=n.offsetTop-n.offsetHeight})},r=function(e){_.isArray(e)&&e.length>0&&(n.selected=e,n.query="",n.showSelected=!0)};n.suggestions=[],n.selectedIndex=-1,n.allowMultiselect&&(n.selected=[]),n.showSuggestions=!1,n.addSuggested=function(e){n.allowMultiselect?(s(e),a(n.selected),r(n.selected)):a(e)},n.updateSelectedIndex=function(e){n.selectedIndex=e},n.removeSelected=function(e){var t=n.selected.indexOf(e);n.selected.splice(t,1)},l.on("keydown",function(e){if(0!==n.suggestions.length&&i.indexOf(e.which)!==-1){switch(e.which){case 38:n.selectedIndex>0&&(n.selectedIndex--,o(n.selectedIndex));break;case 40:n.selectedIndex<n.suggestions.length-1&&(n.selectedIndex++,o(n.selectedIndex));break;case 32:n.allowMultiselect&&s(n.suggestions[n.selectedIndex]);break;case 27:n.showSuggestions=!1;break;case 9:n.allowMultiselect&&(a(n.selected),r(n.selected),n.showSuggestions=!1);break;default:13===e.which&&(n.allowMultiselect&&n.selected.length>0?(r(n.selected),a(n.selected)):!n.allowMultiselect&&n.selectedIndex>-1&&a(n.suggestions[n.selectedIndex]))}n.$apply()}}),n.$watch("query",function(e,t){e===t&&""!==e||(n.selectedIndex=-1,n.suggestions=c(e,n.facets),r(e))}),n.$watch("facets",function(e){n.suggestions=e.slice()}),t.on("click",function(e){3!==e.which&&l.find("input")[0]!==e.target&&n.$apply(function(){n.showSuggestions=!1})}),n.$on("$destroy",function(){l.off("keydown")})}}}e.$inject=["$timeout","$document"],angular.module("ngFacetly").directive("facetlyTypeahead",e)}(),angular.module("ngFacetly").run(["$templateCache",function(e){e.put("angular-facetly.html",'<div class="facetly">\n  <div class="facetly-search">\n    <div class="facetly-searchbox">\n      <ul class="facetly-filters">\n        <facetly-filter\n          ng-repeat="filter in filters"\n          filter="filter"\n          on-filter-remove="removeFilter(id)"\n          on-do-search="search()"\n          should-focus="filters.indexOf(filter) === focusIndex" />\n      </ul>\n\n      <facetly-typeahead\n        ng-show="filters.length !== facets.length"\n        query="query"\n        facets="typeaheadSuggestions"\n        hide-not-found="options.defaultFacet && !filters.length"\n        on-select="addTypeaheadSuggestion(value)"\n        placeholder="{{options.placeholder}}" />\n    </div>\n\n    <div class="facetly-buttons">\n      <a class="facetly-button facetly-button-danger" href="" ng-if="filters.length" ng-click="removeAllFilters()">Remove all</a>\n      <a href="" class="facetly-button facetly-button-success" ng-click="search()">Search</a>\n    </div>\n  </div>\n\n  <p class="facetly-hint-text facetly-text-gray">Hint: You can use advanced search keywords to more easily find what youâ€™re looking for. <a href="" ng-click="showFacets=!showFacets">What keywords can I use?</a></p>\n\n  <ul class="facetly-facets" ng-show="showFacets">\n    <li ng-repeat="facet in facets | filter:availableFacets">\n      <a class="facetly-facet" href="" title="" ng-click="addFilter(facet)" ng-bind="facet.label"></a>\n    </li>\n  </ul>\n</div>\n'),e.put("facets/hierarchy.html",'<div class="facetly-hierarchy">\n\n  <facetly-typeahead\n    allow-multiselect="allowMultiselect"\n    query="query"\n    facets="typeaheadSuggestions"\n    on-select="addTypeaheadSuggestion(value)"\n    placeholder="Start typing to filter..." />\n\n</div>\n'),e.put("facets/select.html",'<div class="facetly-select">\n\n  <facetly-typeahead\n    allow-multiselect="allowMultiselect"\n    query="query"\n    facets="typeaheadSuggestions"\n    on-select="addTypeaheadSuggestion(value)"\n    placeholder="Start typing to filter..." />\n\n</div>\n'),e.put("filter/filter.html",'<li>\n  <span class="facetly-facet">\n    <a class="facetly-icon facetly-text-danger" href="" tabindex="-1" ng-click="remove()"> &times; </a>\n    {{::filter.label}}:\n  </span>\n  <span class="facetly-value" ng-switch="filter.type">\n    <facetly-select ng-switch-when="select" options="filter.options" allow-multiselect="filter.multiselect" on-select-change="updateFilterValue(value)" />\n    <facetly-hierarchy ng-switch-when="hierarchy" options="filter.options" allow-multiselect="filter.multiselect" on-select-change="updateFilterValue(value)" />\n    <input ng-switch-default type="text" class="facetly-form-control" ng-model="filter.value" />\n  </span>\n</li>\n'),e.put("typeahead/typeahead.html",'<div class="facetly-typeahead">\n  <div class="facetly-typeahead-selected" ng-show="showSelected">\n    <span ng-repeat="value in selected">\n      <a class="facetly-icon facetly-text-danger" href="" tabindex="-1" ng-click="removeSelected(value)">&times;</a> {{value}}\n    </span>\n  </div>\n\n  <input\n    class="facetly-form-control"\n    type="text"\n    ng-model="query"\n    ng-focus="showSuggestions=true"\n    ng-click="showSuggestions=true"\n    placeholder="{{placeholder}}">\n\n  <div class="facetly-typeahead-suggestions" ng-show="showSuggestions">\n    <ul>\n      <li class="facetly-suggestion" ng-repeat="suggestion in suggestions"\n        ng-class="{\'selected\': suggestions.indexOf(suggestion) === selectedIndex}"\n        ng-mouseenter="updateSelectedIndex(suggestions.indexOf(suggestion))">\n          <a href="" ng-click="addSuggested(suggestion)">\n            <span ng-if="allowMultiselect && selected.indexOf(suggestion) !== -1">&#10004;</span>\n            <span ng-bind-html="suggestion | facetlyHighlight:query"></span>\n          </a>\n      </li>\n      <li ng-show="query.length && !suggestions.length && !hideNotFound">\n        <span>No match found...</span>\n      </li>\n    </ul>\n  </div>\n</div>\n')}]);